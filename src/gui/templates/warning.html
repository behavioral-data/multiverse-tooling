<!DOCTYPE html>
<html lang="en" class="h-100">

<head>
    <meta charset="utf8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Multiverse Warnings Aggregated</title>
    <!-- CSS only -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.2.0/dist/css/bootstrap.min.css" rel="stylesheet"
        integrity="sha384-gH2yIJqKdNHPEq0n4Mqa/HGKIhSkIHeL5AyhkYV8i59U5AR6csBvApHHNl/vI1Bx" crossorigin="anonymous">
    <link type="text/css" href="/dist/monaco.css" rel="stylesheet" />
    <link type="text/css" href="/dist/prism.css" rel="stylesheet" />
    <script type="text/javascript" src="https://code.jquery.com/jquery-3.4.1.min.js"></script>

    <!-- JavaScript Bundle with Popper -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.2.0/dist/js/bootstrap.bundle.min.js"
        integrity="sha384-A3rJD856KowSb7dwlZdYEkO39Gagi7vIsF0jrRAoQmDKKtQBHUuLZ9AsSv4jD4Xa"
        crossorigin="anonymous"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/prism/9000.0.1/prism.min.js"
        integrity="sha512-UOoJElONeUNzQbbKQbjldDf9MwOHqxNz49NNJJ1d90yp+X9edsHyJoAs6O4K19CZGaIdjI5ohK+O2y5lBTW6uQ=="
        crossorigin="anonymous" referrerpolicy="no-referrer"></script>
</head>

<body class="h-100" style="overflow: hidden;">
    <div class="container-fluid h-100">

        <div class="row">
            <div class="col-3 vh-100">
                <div style="text-align: center;">
                    <h4>Aggregate Warnings</h4>
                    <div class="progress mt-2 mb-1"  style="height: 10px;">
                        <div class="progress-bar bg-success" role="progressbar" style="width: {{progress_val}}%;" aria-valuenow="{{progress_val}}" aria-valuemin="0" aria-valuemax="100"></div>
                    </div>
                    {{progress_str}}
                </div>
                <div class="list-group list-group-flush overflow-auto" id="list-tab" role="tablist"
                    style="overflow-y: scroll; height: 88%; overflow-x: hidden;">
                    {% for error in errors%}
                        {% if loop.index0 == 0 %}
                        <a class="list-group-item list-group-item-action active" id="list-{{loop.index0}}-list" 
                        href="#list-{{loop.index0}}" role="tab">
                        {% else %}
                        <a class="list-group-item list-group-item-action" id="list-{{loop.index0}}-list"
                        href="#list-{{loop.index0}}" role="tab">
                        {% endif %}
                            <div class="d-flex w-100 justify-content-between">
                                <h5 class="mb-1">{{error["error_msg_first_line"]}}</h5>
                            </div>
                            <p class="mb-1" style="white-space: pre-wrap;">{{error["error_msg_first_lines"]}}</p>
                            <span class="badge badge-primary badge-pill"
                                style="background-color:blue;">{{error["number_affected"]}}</span>
                        </a>
                    {% endfor %}
                </div>
            </div>
            <div class="col-9 vh-100">
                <div class="row">
                    <div class="col">
                        <div class="col">
                            <div class="toast" role="alert" aria-live="assertive" aria-atomic="true"
                                data-autohide="true" style="width: 100%; position: relative; top: 0; left: 0;">
                                <div class="toast-body" id="toast-message" style="width: 100%;">
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="col">
                        <div class="btn-toolbar justify-content-end">
                            <div class="btn-group mr-2" role="group" aria-label="Controls">
                                <button type="button" class="btn btn-default btn-primary toggle-mode"
                                    onclick="location.href='/'">View Aggregate Errors</button>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="tab-content h-100" id="nav-tabContent" style="overflow: hidden;">
                    {% for error in errors %}
                        {% set outer_loop = loop %}
                        {% if outer_loop.index0 == 0 %}
                            <div class="tab-pane h-100 active show" id="list-{{loop.index0}}" role="tabpanel">
                        {% else %}
                            <div class="tab-pane h-100" id="list-{{loop.index0}}" role="tabpanel">
                        {% endif %}
                            <h5>Error</h5>
                            <div class="row" , style="height: 45%; ">
                                
                                <pre style="white-space: pre-wrap; max-height: 90%; overflow: scroll; font-size: 0.9em"><code class="language-{{lang}}">{{error["error_msg"]}}</code> </pre>
                            </div>
                            <h5 style="width: 100%;"">Decisions and Options that Isolate this Warning</h5>
                            <div class="d-flex justify-content-start align-items-start m-2" style="height: 10%; flex-wrap: wrap; overflow: scroll;"> 
                                
                                
                                {% for decision, options_str in error["common_decs"].items()%}
                                <button type="button" class="btn btn-primary btn-m m-lg-2" data-bs-toggle="popover" 
                                data-bs-trigger="focus" title="Relevant Options" data-bs-content="{{options_str}}">
                                    {{decision}}
                                </button>
                            {% endfor %}
                            </div>
                            <div class="row" style="height: 28%;">
                                <h5>Common Universes</h5>
                                <div class="col-2" style="max-height: 90%; overflow: auto;">
                                    <div class="list-group list-group-flush overflow-auto" id="common_universes"
                                        role="tablist" style=" overflow-y: scroll; height: 100%;">
                                        {% for universe in error["common_universes"]%}
                                            {% if loop.index0 == 0 %}
                                                <a class="list-group-item list-group-item-action universe-group-item active"
                                                id="list-{{outer_loop.index0}}-universe-{{loop.index0}}-list"
                                                href="#list-{{outer_loop.index0}}-universe-{{loop.index0}}" role="tab">
                                            {% else %}
                                                <a class="list-group-item list-group-item-action universe-group-item"
                                                    id="list-{{outer_loop.index0}}-universe-{{loop.index0}}-list"
                                                    href="#list-{{outer_loop.index0}}-universe-{{loop.index0}}" role="tab">
                                            {% endif %}
                                                {{universe["universe_num"]}}</a>
                                        {% endfor %}
                                    </div>
                                </div>
                                
                                <div class="col-10" , style="max-height: 90%;  overflow: auto;">
                                    <div class="tab-content h-100" id="nav-tabContent-universes"
                                        style="overflow: scroll;">

                                        {% for universe in error["common_universes"]%}
                                            {% if loop.index0 == 0 %}
                                                <div class="tab-pane h-100 active show"
                                                id="list-{{outer_loop.index0}}-universe-{{loop.index0}}" role="tabpanel">
                                            {% else %}
                                                <div class="tab-pane h-100"
                                                id="list-{{outer_loop.index0}}-universe-{{loop.index0}}"
                                                role="tabpanel">
                                            {% endif %}
                                                <h6>Filepath</h6>
                                                <pre style="white-space: pre-wrap; font-size: 0.8rem; height: 60px; overflow-y: hidden;"><code class="language-bash">{{universe["universe_path"]}}.py</code>
                                                </pre>
                                                <div class="table-responsive" style="max-height: 70%; overflow: scroll;">
                                                    <table class="table">
                                                        <thead class="table-light">
                                                            <tr>
                                                                <th scope="col">Decisions</th>
                                                                {% for decisions in universe["decisions"] %}
                                                                    <td>{{decisions["decision"]}}</td>
                                                                {% endfor %}
                                                            </tr>
                                                        </thead>
                                                        <tbody>
                                                            <tr>
                                                                <th scope="row">Option</th>
                                                                {% for decisions in universe["decisions"] %}
                                                                    <td>{{decisions["option"]}}</td>
                                                                {% endfor %}
                                                            </tr>
                                                        </tbody>
                                                    </table>
                                                </div>
                                                </div>
                                        {% endfor %}
                                    </div>
                                </div>
                            </div>
                        </div>
                            {% endfor %}
                        </div>

                    </div>
                </div>
            </div>
            <script type="text/javascript" src="/web/monaco-editor/min/vs/loader.js"></script>
            <script type="text/javascript" src="/dist/shortcuts.js"></script>
            <script type="text/javascript" src="/dist/prism.js"></script>
            <script type="text/javascript" src="load_error_info.js"></script>
            <script>
                $(document).ready(function () {
                    $(".toggle-mode").click(function () {
                        var left = $("#sidebar-left"),
                            right = $("#sidebar-right");
                        left.toggleClass("collapsed");
                        right.toggleClass("collapsed");

                        var elem = document.getElementById("button-toggle");
                        if (elem.innerText == "View Mode") elem.innerText = "Edit Mode";
                        else elem.innerText = "View Mode";
                        return false;
                    });
                });
                $('#list-tab a').on('click', function (e) {
                    e.preventDefault()
                    $(this).tab('show')
                })

                $(document).ready(function () {
                    $('a.universe-group-item').click(function (e) {
                        e.preventDefault()
                        $(this).tab('show')
                    });
                });
                $(document).ready(function () {

                $('.popover-dismiss').popover({
                    trigger: 'focus'
                });

                });
            </script>
</body>

</html>